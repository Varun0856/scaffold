#!/bin/bash

project_name=$1

if [ -z "$project_name" ]; then
  echo "Usage: scaffold <project_name>" >&2
  exit 2
fi

if [ -e "$project_name" ]; then
  echo "Error: $project_name already exists" >&2
  exit 1
fi

if ! command -v git &>/dev/null; then
  echo "Error: git is not installed" >&2
  exit 1
fi

parent_dir=$(dirname "$project_name")

if [ ! -d "$parent_dir" ] || [ ! -w "$parent_dir" ]; then
  echo "Parent directory $parent_dir does not exist or is not writable" >&2
  exit 1
fi

mkdir "$project_name"
cd "$project_name" || exit 1
if ! git init -b main >/dev/null 2>&1; then
  echo "Error: Failed to initialize git repository" >&2
  exit 1
fi

echo "# $project_name" >README.md
echo ".DS_Store" >>.gitignore
echo "*.log" >>.gitignore
mkdir "src" || exit 1

if ! git add .; then
  echo "Error: Failed to add files to git" >&2
  exit 1
fi

if ! git commit -m "Initial commit"; then
  echo "Error: Failed to commit files to git" >&2
  exit 1
fi

echo "Project $project_name created successfully"
